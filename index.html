<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Blocking Widget</title>
    <style>
        body {
            font-family: "Times New Roman", serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid sagegreen;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid sagegreen;
            padding: 10px;
            overflow: hidden;
            white-space: nowrap;
        }
        th {
            text-align: center;
            background-color: #f0f0f0;
        }
        td:first-child {
            text-align: right;
        }
        td:last-child {
            text-align: left;
        }
        .selected {
            border: 2px solid blue !important;
        }
        .active {
            border: 2px solid blue !important;
        }
        .resize-handle {
            position: absolute;
            width: 5px;
            height: 5px;
            background: gray;
            cursor: pointer;
        }
        #context-menu {
            position: absolute;
            background: white;
            border: 1px solid black;
            display: none;
            z-index: 1000;
        }
        #context-menu ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #context-menu ul li {
            padding: 5px 10px;
            cursor: pointer;
        }
        #context-menu ul li:hover {
            background: lightgray;
        }
    </style>
</head>
<body>
    <table id="timeTable">
        <thead>
            <tr>
                <th colspan="2" contenteditable="true">Schedule</th>
            </tr>
        </thead>
        <tbody>
            <script>
                for (let hour = 7; hour <= 24; hour++) {
                    let displayHour = hour > 12 ? hour - 12 : hour;
                    let period = hour >= 12 ? "PM" : "AM";
                    document.write(`<tr><td>${displayHour} ${period}</td><td contenteditable="true"></td></tr>`);
                }
            </script>
        </tbody>
    </table>

    <div id="context-menu">
        <ul>
            <li onclick="mergeCells()">Merge</li>
            <li onclick="unmergeCells()">Unmerge</li>
            <li onclick="openColorPicker()">Change Color</li>
        </ul>
    </div>

    <input type="color" id="colorPicker" style="display: none;" onchange="changeCellColor()">
    
    <script>
        let selectedCells = [];
        document.querySelectorAll("td").forEach(cell => {
            cell.addEventListener("mousedown", (event) => {
                if (!event.ctrlKey) {
                    document.querySelectorAll(".selected").forEach(el => el.classList.remove("selected"));
                    selectedCells = [];
                }
                cell.classList.add("selected");
                selectedCells.push(cell);
            });

            cell.addEventListener("contextmenu", (event) => {
                event.preventDefault();
                let menu = document.getElementById("context-menu");
                menu.style.top = `${event.clientY}px`;
                menu.style.left = `${event.clientX}px`;
                menu.style.display = "block";
            });
        });

        document.addEventListener("click", () => {
            document.getElementById("context-menu").style.display = "none";
        });

        function mergeCells() {
            if (selectedCells.length > 1) {
                let first = selectedCells[0];
                let span = selectedCells.length;
                first.rowSpan = span;
                selectedCells.slice(1).forEach(cell => cell.remove());
                selectedCells = [first];
            }
        }

        function unmergeCells() {
            selectedCells.forEach(cell => {
                cell.rowSpan = 1;
            });
        }

        function openColorPicker() {
            document.getElementById("colorPicker").click();
        }

        function changeCellColor() {
            let color = document.getElementById("colorPicker").value;
            selectedCells.forEach(cell => {
                cell.style.backgroundColor = color;
            });
        }
    </script>
</body>
</html>
